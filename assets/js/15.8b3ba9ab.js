(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{180:function(a,t,s){"use strict";s.r(t);var e=s(0),n=Object(e.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"性能优化"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#性能优化","aria-hidden":"true"}},[a._v("#")]),a._v(" 性能优化")]),a._v(" "),s("h2",{attrs:{id:"配置参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置参数","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置参数")]),a._v(" "),s("ul",[s("li",[s("p",[s("code",[a._v("max_connections")]),s("br"),a._v("\n连接数")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("max_user_connections")])]),a._v(" "),s("p",[a._v("每个数据库用户的最大连接")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("back_log")])]),a._v(" "),s("p",[a._v("MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("wait_timeout")])]),a._v(" "),s("p",[a._v("MySQL客户端的数据库连接闲置最大时间值。")])]),a._v(" "),s("li",[s("p",[s("code",[a._v("thread_concurrency")])]),a._v(" "),s("p",[a._v("让MySQL充分利用多核，"),s("code",[a._v("MySQL 5.7已经移除")])])]),a._v(" "),s("li",[s("p",[s("code",[a._v("skip-name-resolve")])])]),a._v(" "),s("li")]),a._v(" "),s("h2",{attrs:{id:"max-connections"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#max-connections","aria-hidden":"true"}},[a._v("#")]),a._v(" max_connections")]),a._v(" "),s("ul",[s("li",[a._v("max_connections是指MySql的最大连接数")]),a._v(" "),s("li",[a._v("默认配置默认是151")]),a._v(" "),s("li",[a._v("MySQL服务器允许最大的连接数是16384")]),a._v(" "),s("li",[a._v("查看系统当前的最大连接数")])]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("show")]),a._v(" variables "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("like")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'max_connections'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"max-user-connections"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#max-user-connections","aria-hidden":"true"}},[a._v("#")]),a._v(" max_user_connections")]),a._v(" "),s("ul",[s("li",[a._v("是指每个数据库用户的最大连接")]),a._v(" "),s("li",[a._v("设置为0，表示不限制，"),s("code",[a._v("默认是0")])])]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("show")]),a._v(" variables "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("like")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'max_user_connections'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"back-log"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#back-log","aria-hidden":"true"}},[a._v("#")]),a._v(" back_log")]),a._v(" "),s("ul",[s("li",[a._v("MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中")]),a._v(" "),s("li",[a._v("也就是说，如果MySql的连接数据达到max_connections时，新来的请求将会被存在堆栈中以等待某一连接释放资源，该堆栈的数量即back_log，")]),a._v(" "),s("li",[a._v("如果等待连接的数量超过back_log，将不被授予连接资源。将会报错。unauthenticated user | xxx.xxx.xxx.xxx | NULL | Connect | NULL | login | NULL 的待连接进程时.")]),a._v(" "),s("li",[a._v("back_log值不能超过TCP/IP连接的侦听队列的大小。若超过则无效。查看当前系统的TCP/IP连接的侦听队列的大小命令：cat /proc/sys/net/ipv4/tcp_max_syn_backlog目前系统为1024。对于Linux系统推荐设置为小于512的整数。")])]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("show")]),a._v(" variables "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("like")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'back_log'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"wait-timeout"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wait-timeout","aria-hidden":"true"}},[a._v("#")]),a._v(" wait_timeout")]),a._v(" "),s("ul",[s("li",[a._v("MySQL客户端的数据库连接闲置最大时间值。")]),a._v(" "),s("li",[a._v("当你的MySQL连接闲置超过一定时间后将会被强行关闭")]),a._v(" "),s("li",[a._v("MySQL默认的wait-timeout  值为8个小时")]),a._v(" "),s("li",[a._v("设置这个值是非常有意义的，比如你的网站有大量的MySQL链接请求（每个MySQL连接都是要内存资源开销的 ），由于你的程序的原因有大量的连接请求空闲啥事也不干，白白占用内存资源，或者导致MySQL超过最大连接数从来无法新建连接导致“Too many connections”的错误。")]),a._v(" "),s("li",[a._v("在设置之前你可以查看一下你的MYSQL的状态（可用"),s("code",[a._v("show processlist")]),a._v(")，如果经常发现MYSQL中有大量的"),s("code",[a._v("Sleep")]),a._v("进程，则需要 修改"),s("code",[a._v("wait-timeout")]),a._v("值了。")]),a._v(" "),s("li",[a._v("interactive_timeout：服务器关闭交互式连接前等待活动的秒数。交互式客户端定义为在mysql_real_connect()中使用CLIENT_INTERACTIVE选项的客户端。")]),a._v(" "),s("li",[a._v("wait_timeout:服务器关闭非交互连接之前等待活动的秒数。在线程启动时，根据全局wait_timeout值或全局 interactive_timeout值初始化会话wait_timeout值，取决于客户端类型(由mysql_real_connect()的连接选项CLIENT_INTERACTIVE定义).")]),a._v(" "),s("li",[a._v("这两个参数必须配合使用。否则单独设置wait_timeout无效")])]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("show")]),a._v(" variables "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("like")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'wait_timeout'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])]),s("h2",{attrs:{id:"thread-concurrency"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#thread-concurrency","aria-hidden":"true"}},[a._v("#")]),a._v(" thread_concurrency")]),a._v(" "),s("ul",[s("li",[a._v("MySQL 5.7已经废除该参数")]),a._v(" "),s("li",[a._v("thread_concurrency的值的正确与否, 对mysql的性能影响很大, 在多个cpu(或多核)的情况下，错误设置了thread_concurrency的值, 会导致mysql不能充分利用多cpu(或多核), 出现同一时刻只能一个cpu(或核)在工作的情况。")]),a._v(" "),s("li",[a._v("thread_concurrency应设为CPU核数的2倍. 比如有一个双核的CPU, 那thread_concurrency  的应该为4; 2个双核的cpu, thread_concurrency的值应为8。")]),a._v(" "),s("li",[a._v("比如：根据上面介绍我们目前系统的配置，可知道为4个CPU,每个CPU为8核，按照上面的计算规则，这儿应为:4"),s("em",[a._v("8")]),a._v("2=64")])]),a._v(" "),s("div",{staticClass:"language-sql line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-sql"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("show")]),a._v(" variables "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("like")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[a._v("'thread_concurrency'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[a._v("1")]),s("br")])])])}],!1,null,null,null);n.options.__file="optimize.md";t.default=n.exports}}]);